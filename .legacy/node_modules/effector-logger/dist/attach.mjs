import{is as o,createNode as e,step as t}from"effector";import*as n from"effector-inspector";import s from"just-debounce-it";import c from"detect-node";import i from"set-value";const a="@effector-logger";function r(o){return o.path.filter((o=>"@effector-logger"!==o)).join("/")}function f(o){var e,t,n;return null!==(n=null===(t=null===(e=o.defaultConfig)||void 0===e?void 0:e.loc)||void 0===t?void 0:t.file)&&void 0!==n?n:" "}function l(n,s,c){o.domain(s)?function(e,t,n){o.store(e)&&n(e.getState()),(o.store(e)?e.updates:e).watch(n)}(n,0,c):function(n,s,c){o.store(n)&&c(s.getState(n));const i=e({node:[t.run({fn:c})]}),a=(o.store(n)?n.updates:n).graphite.id;(s.additionalLinks[a]=s.additionalLinks[a]||[]).push(i)}(n,s,c)}const d=c?"  ":"",p=[],u=[],g=[],m="padding-left: 4px; padding-right: 4px; font-weight: normal;",h="padding-left: 4px; padding-right: 4px; font-weight: normal;",b="background-color: #7e57c2; color: #fff",E="background-color: #9ccc65; color: #000",v="background-color: #26a69a; color: #000",$="",x="color: #9e9e9e; padding-left: 20px;",y="color: currentColor; background-color: transparent;",N=[["☄️","%s",'line-height:1.5; color: #000; font-family: "Apple Emoji Font"; font-weight: normal !important;'],["effector","%s","font-family: Menlo, monospace;"]];function S(o,e,t){const n=[],s=[];o.unshift(...N),o.forEach((([e,t,c],i)=>{n.push(`%c${t}%c`),s.push(`${m} ${c}`,e,((o,e,t)=>o===e-1?y:t)(i,o.length,`${m} ${c}`))})),e.forEach((([o,e,t])=>{n.push(`%c${e}`),s.push(`${h} ${t}`,o)}));const c=[n.join(d),...s];"open"===t?console.group(...c):"collapsed"===t?console.groupCollapsed(...c):console.log(...c)}const w=["new","%s","background-color: #29b6f6; color: #000"],j=o=>o.split("/").pop()||o,k=o=>[j(o),"%s",b],C=o=>[j(o),"%s",E],O=o=>[j(o),"%s",v],_=s((()=>{const o=p.splice(0),e=u.splice(0),t=g.splice(0);o.length+e.length+t.length>0&&(S([w],[["Initialized","%s",""],[`events(${e.length})`,"%s",""],[`effects(${t.length})`,"%s",""],[`stores(${o.length})`,"%s",""]],"collapsed"),o.length&&o.forEach((o=>{const e=r(o.compositeName),t=f(o);S([w,k(e)],[["-> ","%s",""],[o.getState(),"%o",""],[t,"%s",x],[e,"%s",""]])})),e.length>0&&e.forEach((o=>{const e=r(o.compositeName),t=f(o);S([w,C(e)],[[t,"%s",x],[e,"%s",""]])})),t.length>0&&t.forEach((o=>{const e=r(o.compositeName),t=f(o);S([w,O(e)],[[t,"%s",x],[e,"%s",""]])})),console.groupEnd())}),5);const D="undefined"!=typeof window&&window.__REDUX_DEVTOOLS_EXTENSION__;const F={instanceId:"object"==typeof document?`☄️ ${document.title}`:"☄️ no title instance"},I={};function L(o,e){i(I,o.replace(/\//g,"."),e)}function T(o,e){L(o,{inFlight:e.inFlight.getState(),pending:e.pending.getState()})}const X={reduxDevtools:"enabled",console:"enabled",inspector:"enabled"};function z(e,t={}){const s=Object.assign(Object.assign({},X),t),c="enabled"===s.console,i="enabled"===s.reduxDevtools,a="enabled"===s.inspector;function d(o){const t=r(o.compositeName),s=f(o);c&&function(o){u.push(o),_()}(o),a&&n.addEvent(o),l(o,e,(o=>{c&&function(o,e,t){S([C(o)],[[t,"%o","padding-left: 4px;"],[e,"%s",x],[o,"%s",x]])}(t,s,o),i&&function(o,e){D&&D.send({type:`${o} (event)`,payload:e},I,F)}(t,o)}))}function m(o){const t=r(o.compositeName),s=f(o);c&&function(o){p.push(o),_()}(o),i&&function(o){L(r(o.compositeName),o.defaultState)}(o),a&&n.addStore(o);const d=o.map.bind(o);o.map=(e,t)=>{const s=d(e,t);return s.compositeName.path=o.compositeName.path.slice(0,-1),s.compositeName.path.push(o.compositeName.path.slice(-1)+" -> *"),a&&n.addStore(s,{mapped:!0}),s},l(o,e,(o=>{c&&function(o,e,t){S([k(o)],[["-> ","%s",""],[t,"%o",""],[e,"%s",x],[o,"%s",x]])}(t,s,o),i&&function(o,e){L(o,e),D&&D.send({type:`${o} (store updated)`,value:e},I,F)}(t,o)}))}function h(o){const t=r(o.compositeName),s=f(o);c&&function(o){g.push(o),_()}(o),i&&function(o,e){T(o,e)}(t,o),a&&n.addEffect(o),l(o,e,(e=>{c&&function(o,e,t){S([O(o)],[[t,"%o","padding-left: 4px;"],[e,"%s",x],[o,"%s",x]])}(t,s,e),i&&function(o,e,t){T(o,e),D&&D.send({type:`${o} (effect called)`,params:t},I,F)}(t,o,e)})),l(o.done,e,(({params:e,result:n})=>{c&&function(o,e,t,n){S([O(o)],[["done ✅","%s",$],[t,"(%o)","padding-left: 4px;"],["-> ","%s",""],[n,"%o","padding: 0;"],[e,"%s",x],[o,"%s",x]])}(t,s,e,n),i&&function(o,e,t,n){T(o,e),D&&D.send({type:`${o}.done (effect finished)`,params:t,result:n},I,F)}(t,o,e,n)})),l(o.fail,e,(({params:e,error:n})=>{c&&function(o,e,t,n){const s=n instanceof Error;S([O(o)],[["fail ❌","%s",$],[t,"(%o)","padding-left: 4px;"],["-> ","%s",""],s?[String(n),"%s",""]:[n,"%o","padding: 0;"],[e,"%s",x],[o,"%s",x]],s?"collapsed":void 0),s&&S([],[[" ","%s",""],[n,"%o","padding-left: 20px;"]]),console.groupEnd()}(t,s,e,n),i&&function(o,e,t,n){T(o,e),D&&D.send({type:`${o}.fail (effect finished)`,params:t,error:n},I,F)}(t,o,e,n)}))}if(o.domain(e))e.onCreateEvent(d),e.onCreateStore(m),e.onCreateEffect(h);else{const o=e.cloneOf;if(void 0===o)throw new Error("Scope should be created from domain");for(const e of o.history.events)d(e);for(const e of o.history.effects)h(e);for(const e of o.history.stores)m(e)}}export{a as LOGGER_DOMAIN_NAME,z as attachLogger};
//# sourceMappingURL=attach.mjs.map
